{% extends "base.html" %}

{% block title %}GRAVIS - Home{% endblock %}

{% block head %}
    {# Preload analysis/field libs for faster load when user opens Rotation Curves or Field #}
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js" as="script">
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/hammerjs@2.0.8" as="script">
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js" as="script">
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js" as="script">
{% endblock %}

{% block content %}
<div class="home-screen">
    <div class="home-container">

        <!-- Header -->
        <div class="home-header">
            <h1 class="home-title">GRAVIS</h1>
            <p class="home-subtitle">Gravity Field Dynamics Research Platform</p>
        </div>

        <!-- Paper callout -->
        <div class="home-callout">
            <div class="home-callout-sub">
                Dual Tetrad Topology and Covariant Completion: Zero-Parameter Scalar-Tensor Formulation
            </div>
            <p class="home-callout-note">
                Gravity Field Dynamics (GFD) is the covariant completion of the dual tetrad topology, producing a zero-parameter scalar-tensor action in which every physical quantity is derived from the geometry. The GFD prediction is available in the
                <strong>Rotation Curves</strong> module under the
                <span class="home-callout-badge" style="--chip-color: #4da6ff;">GFD</span>
                series label on all graphs.
            </p>
        </div>

        {#
          SVG icon map: keyed by service id.
          Icons are defined here because they are visual assets
          specific to the dashboard, not service metadata.
        #}

        {# Category display names and section icons #}
        {% set category_meta = {
            "galactic": {
                "label": "Galactic",
                "icon": '<svg class="home-section-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"/><ellipse cx="12" cy="12" rx="10" ry="4" transform="rotate(-30 12 12)"/><ellipse cx="12" cy="12" rx="10" ry="4" transform="rotate(30 12 12)"/></svg>'
            },
            "cosmological": {
                "label": "Cosmological",
                "icon": '<svg class="home-section-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10 10-4.5 10-10S17.5 2 12 2z"/><path d="M2 12h20"/><path d="M12 2c2.5 2.5 4 6 4 10s-1.5 7.5-4 10c-2.5-2.5-4-6-4-10s1.5-7.5 4-10z"/></svg>'
            },
            "quantum_nuclear": {
                "label": "Quantum and Nuclear",
                "icon": '<svg class="home-section-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="2"/><ellipse cx="12" cy="12" rx="10" ry="3"/><ellipse cx="12" cy="12" rx="10" ry="3" transform="rotate(60 12 12)"/><ellipse cx="12" cy="12" rx="10" ry="3" transform="rotate(120 12 12)"/></svg>'
            },
            "platform": {
                "label": "Platform",
                "icon": '<svg class="home-section-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/><line x1="10" y1="6.5" x2="14" y2="6.5"/><line x1="6.5" y1="10" x2="6.5" y2="14"/></svg>'
            }
        } %}

        {# Card icons keyed by service id #}
        {% set card_icons = {
            "rotation": '<svg class="home-card-icon" viewBox="0 0 24 24" fill="none" stroke="#4da6ff" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="3,17 7,13 11,15 15,9 21,6"/><line x1="3" y1="21" x2="3" y2="3"/><line x1="3" y1="21" x2="21" y2="21"/></svg>',
            "rar": '<svg class="home-card-icon" viewBox="0 0 24 24" fill="none" stroke="#4da6ff" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="6" cy="18" r="2"/><circle cx="10" cy="13" r="2"/><circle cx="14" cy="10" r="2"/><circle cx="18" cy="7" r="2"/><line x1="3" y1="21" x2="3" y2="3"/><line x1="3" y1="21" x2="21" y2="21"/></svg>',
            "redshift": '<svg class="home-card-icon" viewBox="0 0 24 24" fill="none" stroke="#ef5350" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12c2-3 4-4 6-4s4 2 6 2 4-1 6-4"/><path d="M3 16c2-3 4-4 6-4s4 2 6 2 4-1 6-4" opacity="0.5"/><line x1="19" y1="5" x2="21" y2="5"/><line x1="19" y1="5" x2="19" y2="7"/></svg>',
            "solar": '<svg class="home-card-icon" viewBox="0 0 24 24" fill="none" stroke="#ffa726" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="4"/><circle cx="12" cy="12" r="8" stroke-dasharray="3 3"/><circle cx="12" cy="12" r="11" stroke-dasharray="2 4"/></svg>',
            "valence": '<svg class="home-card-icon" viewBox="0 0 24 24" fill="none" stroke="#ab47bc" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="2"/><circle cx="12" cy="5" r="1.5"/><circle cx="18" cy="9" r="1.5"/><circle cx="18" cy="16" r="1.5"/><circle cx="12" cy="19" r="1.5"/><circle cx="6" cy="16" r="1.5"/><circle cx="6" cy="9" r="1.5"/></svg>',
            "a0_derivation": '<svg class="home-card-icon" viewBox="0 0 24 24" fill="none" stroke="#4da6ff" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M4 20l4-8 4 5 4-10 4 6"/><circle cx="12" cy="7" r="3" stroke-dasharray="2 2"/><line x1="12" y1="10" x2="12" y2="15" stroke-dasharray="1 2"/></svg>',
            "nuclear_decay": '<svg class="home-card-icon" viewBox="0 0 24 24" fill="none" stroke="#76FF03" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="4"/><circle cx="10" cy="11" r="1.5" fill="#76FF03" opacity="0.3"/><circle cx="14" cy="13" r="1.5" fill="#76FF03" opacity="0.3"/><line x1="16" y1="8" x2="20" y2="4"/><polyline points="18,4 20,4 20,6"/></svg>',
            "architecture": '<svg class="home-card-icon" viewBox="0 0 24 24" fill="none" stroke="#4da6ff" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/><line x1="10" y1="6.5" x2="14" y2="6.5"/><line x1="6.5" y1="10" x2="6.5" y2="14"/></svg>'
        } %}

        {# Category render order #}
        {% set category_order = ["galactic", "cosmological", "quantum_nuclear", "platform"] %}

        {% for cat in category_order %}
            {% set cat_services = [] %}
            {% for s in services %}
                {% if s.category == cat and s.id != "sandbox" %}
                    {% if cat_services.append(s) %}{% endif %}
                {% endif %}
            {% endfor %}

            {% if cat_services %}
            <section class="home-section">
                <h2 class="home-section-title">
                    {{ category_meta[cat].icon | safe }}
                    {{ category_meta[cat].label }}
                </h2>
                <div class="home-cards">
                    {% for svc in cat_services %}
                        {% if svc.status == "live" %}
                        <a class="home-card" href="{{ svc.route }}">
                            <span class="home-card-live"></span>
                            {{ card_icons.get(svc.id, '') | safe }}
                            <span class="home-card-title">{{ svc.name }}</span>
                        </a>
                        {% else %}
                        <div class="home-card disabled">
                            {{ card_icons.get(svc.id, '') | safe }}
                            <span class="home-card-title">{{ svc.name }}</span>
                            <span class="coming-soon-badge">Coming soon</span>
                        </div>
                        {% endif %}
                    {% endfor %}
                </div>
            </section>
            {% endif %}
        {% endfor %}

    </div>
</div>
{% endblock %}
